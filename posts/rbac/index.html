<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>K8s è®¤è¯å’Œæˆæƒ - Lain Blog</title><meta name=Description content="This is my cool site"><meta property="og:title" content="K8s è®¤è¯å’Œæˆæƒ"><meta property="og:description" content="æ–‡æ¡£ï¼šä½¿ç”¨ RBAC é‰´æƒ | Kubernetes ç”¨æˆ· UserAccountï¼ˆæ™®é€šç”¨æˆ·ï¼‰ï¼šé›†ç¾¤å¤–éƒ¨è®¿é—®æ—¶ä½¿ç”¨çš„ç”¨æˆ·è´¦å·ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ kubectl å‘½ä»¤å°±æ˜¯ä½œä¸º kubernetes-admin ç”¨æˆ·æ¥æ‰§è¡Œï¼Œk8sæœ¬èº«"><meta property="og:type" content="article"><meta property="og:url" content="http://xuliangtang.github.io/posts/rbac/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-03T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-14T22:37:46+08:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary"><meta name=twitter:title content="K8s è®¤è¯å’Œæˆæƒ"><meta name=twitter:description content="æ–‡æ¡£ï¼šä½¿ç”¨ RBAC é‰´æƒ | Kubernetes ç”¨æˆ· UserAccountï¼ˆæ™®é€šç”¨æˆ·ï¼‰ï¼šé›†ç¾¤å¤–éƒ¨è®¿é—®æ—¶ä½¿ç”¨çš„ç”¨æˆ·è´¦å·ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ kubectl å‘½ä»¤å°±æ˜¯ä½œä¸º kubernetes-admin ç”¨æˆ·æ¥æ‰§è¡Œï¼Œk8sæœ¬èº«"><meta name=application-name content="Lain Blog"><meta name=apple-mobile-web-app-title content="Lain Blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicons/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://xuliangtang.github.io/posts/rbac/><link rel=prev href=http://xuliangtang.github.io/posts/kubeadm/><link rel=next href=http://xuliangtang.github.io/posts/pod/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"K8s è®¤è¯å’Œæˆæƒ","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/xuliangtang.github.io\/posts\/rbac\/"},"genre":"posts","wordcount":1551,"url":"http:\/\/xuliangtang.github.io\/posts\/rbac\/","datePublished":"2022-12-03T00:00:00+00:00","dateModified":"2022-12-14T22:37:46+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"xuliangTang"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Lain Blog">Dev Lain</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>æ–‡ç«  </a><a class=menu-item href=/tags/>æ ‡ç­¾ </a><a class=menu-item href=/categories/>åˆ†ç±» </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Lain Blog">Dev Lain</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>æ–‡ç« </a><a class=menu-item href=/tags/ title>æ ‡ç­¾</a><a class=menu-item href=/categories/ title>åˆ†ç±»</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">K8s è®¤è¯å’Œæˆæƒ</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>xuliangTang</a></span>&nbsp;<span class=post-category>included in <a href=/categories/kubernetes/><i class="far fa-folder fa-fw" aria-hidden=true></i>kubernetes</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-12-03>2022-12-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1551 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;4 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#ç”¨æˆ·>ç”¨æˆ·</a></li><li><a href=#ç”¨æˆ·è®¤è¯>ç”¨æˆ·è®¤è¯</a><ul><li><a href=#a-ä½¿ç”¨-x509-å®¢æˆ·è¯ä¹¦>A. ä½¿ç”¨ X509 å®¢æˆ·è¯ä¹¦</a></li><li><a href=#b-ä½¿ç”¨é™æ€ä»¤ç‰Œæ–‡ä»¶token>B. ä½¿ç”¨é™æ€ä»¤ç‰Œæ–‡ä»¶(Token)</a></li></ul></li><li><a href=#èµ„æº>èµ„æº</a></li><li><a href=#role-å’Œ-rolebinding>Role å’Œ RoleBinding</a><ul><li><a href=#åˆ›å»º-role>åˆ›å»º Role</a></li><li><a href=#ç»‘å®š-rolebinding>ç»‘å®š RoleBinding</a></li></ul></li><li><a href=#clusterrole-å’Œ-clusterrolebinding>ClusterRole å’Œ ClusterRoleBinding</a><ul><li><a href=#åˆ›å»º-clusterrole>åˆ›å»º ClusterRole</a></li><li><a href=#ç»‘å®š-rolebinding-1>ç»‘å®š RoleBinding</a></li><li><a href=#ç»‘å®š-clusterrolebinding>ç»‘å®š ClusterRoleBinding</a></li></ul></li><li><a href=#serviceaccount>ServiceAccount</a><ul><li><a href=#åˆ›å»º-sa>åˆ›å»º SA</a></li><li><a href=#ç»‘å®š-clusterrolebinding-1>ç»‘å®š ClusterRoleBinding</a></li><li><a href=#å¤–éƒ¨è®¿é—®-api>å¤–éƒ¨è®¿é—® API</a></li><li><a href=#åœ¨-pod-é‡Œè®¿é—®-api>åœ¨ Pod é‡Œè®¿é—® API</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>æ–‡æ¡£ï¼š<a href=https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/rbac/ target=_blank rel="noopener noreffer">ä½¿ç”¨ RBAC é‰´æƒ | Kubernetes</a></p><h2 id=ç”¨æˆ·>ç”¨æˆ·</h2><ul><li>UserAccountï¼ˆæ™®é€šç”¨æˆ·ï¼‰ï¼šé›†ç¾¤å¤–éƒ¨è®¿é—®æ—¶ä½¿ç”¨çš„ç”¨æˆ·è´¦å·ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ <code>kubectl</code> å‘½ä»¤å°±æ˜¯ä½œä¸º kubernetes-admin ç”¨æˆ·æ¥æ‰§è¡Œï¼Œk8sæœ¬èº«ä¸è®°å½•è¿™äº›è´¦å·</li><li>ServiceAccountï¼ˆæœåŠ¡è´¦æˆ·ï¼‰ï¼šå®ƒä»¬è¢«ç»‘å®šåˆ°ç‰¹å®šçš„åå­—ç©ºé—´ï¼ŒæœåŠ¡è´¦å·ä¸ä¸€ç»„ä»¥ Secret ä¿å­˜çš„å‡­æ®ç›¸å…³ï¼Œè¿™äº›å‡­æ®ä¼šè¢«æŒ‚è½½åˆ° Pod ä¸­ï¼Œä»è€Œå…è®¸é›†ç¾¤å†…çš„è¿›ç¨‹è®¿é—® Kubernetes API</li></ul><h2 id=ç”¨æˆ·è®¤è¯>ç”¨æˆ·è®¤è¯</h2><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/image-20221203231927703.png data-srcset="https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/image-20221203231927703.png, https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/image-20221203231927703.png 1.5x, https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/image-20221203231927703.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/image-20221203231927703.png title=image-20221203231927703></p><h3 id=a-ä½¿ç”¨-x509-å®¢æˆ·è¯ä¹¦>A. ä½¿ç”¨ X509 å®¢æˆ·è¯ä¹¦</h3><h4 id=ç”Ÿæˆè¯ä¹¦>ç”Ÿæˆè¯ä¹¦</h4><p>å®‰è£… OpenSSL</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo yum install openssl openssl-devel
</span></span></code></pre></div><p>ç”Ÿæˆä¸€ä¸ªåç§°ä¸ºtxlçš„æ™®é€šç”¨æˆ·çš„å®¢æˆ·ç«¯è¯ä¹¦</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ mkdir ua/txl
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> ua/txl
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># ç”Ÿæˆå®¢æˆ·ç«¯ç§é’¥</span>
</span></span><span class=line><span class=cl>$ openssl genrsa -out client.key <span class=m>2048</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ ¹æ®ç§é’¥ç”Ÿæˆcsr, æŒ‡å®šç”¨æˆ·åtxl</span>
</span></span><span class=line><span class=cl>$ openssl req -new -key client.key -out client.csr -subj <span class=s2>&#34;/CN=txl&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æ ¹æ®k8sçš„CAè¯ä¹¦ç”Ÿæˆå®¢æˆ·ç«¯è¯ä¹¦</span>
</span></span><span class=line><span class=cl>$ sudo openssl x509 -req -in client.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out client.crt -days <span class=m>365</span>
</span></span></code></pre></div><h4 id=è¯ä¹¦åè§£>è¯ä¹¦åè§£</h4><p>è·å–è¯ä¹¦è®¾ç½®çš„CN(Common name)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ openssl x509 -noout -subject -in client.crt
</span></span></code></pre></div><h4 id=ä½¿ç”¨è¯ä¹¦åˆæ­¥è¯·æ±‚api>ä½¿ç”¨è¯ä¹¦åˆæ­¥è¯·æ±‚API</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get endpoints
</span></span><span class=line><span class=cl>NAME         ENDPOINTS            AGE
</span></span><span class=line><span class=cl>kubernetes   192.168.0.111:6443   4d5h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ curl --cert ./client.crt --key ./client.key --cacert /etc/kubernetes/pki/ca.crt -s https://192.168.0.111:6443/api
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;kind&#34;</span>: <span class=s2>&#34;APIVersions&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;versions&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;v1&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>]</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;serverAddressByClientCIDRs&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=s2>&#34;clientCIDR&#34;</span>: <span class=s2>&#34;0.0.0.0/0&#34;</span>,
</span></span><span class=line><span class=cl>      <span class=s2>&#34;serverAddress&#34;</span>: <span class=s2>&#34;192.168.0.111:6443&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>å¯ä»¥ä½¿ç”¨ <code>--insecure</code> ä»£æ›¿ <code>--cacert /etc/kubernetes/pki/ca.crt</code> å¿½ç•¥æœåŠ¡ç«¯è¯ä¹¦éªŒè¯</p><h4 id=è¯ä¹¦åŠ å…¥-kube-config>è¯ä¹¦åŠ å…¥ kube config</h4><p>æŠŠ client.crt åŠ å…¥åˆ° ~/.kube/config</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl config --kubeconfig<span class=o>=</span>~/.kube/config set-credentials txl --client-certificate<span class=o>=</span>~/ua/txl/client.crt --client-key<span class=o>=</span>~/ua/txl/client.key
</span></span></code></pre></div><p>åˆ›å»ºä¸€ä¸ªåä¸º user_context çš„ context</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl config --kubeconfig<span class=o>=</span>~/.kube/config set-context user_context --cluster<span class=o>=</span>kubernetes --user<span class=o>=</span>txl
</span></span></code></pre></div><p>åˆ‡æ¢å½“å‰ä¸Šä¸‹æ–‡ä¸º user_context</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl config use-context user_context
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹</span>
</span></span><span class=line><span class=cl>$ kubectl config current-context
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># é‡æ–°åˆ‡å›é»˜è®¤ç®¡ç†å‘˜</span>
</span></span><span class=line><span class=cl>$ kubectl config use-context kubernetes-admin@kubernetes
</span></span></code></pre></div><h3 id=b-ä½¿ç”¨é™æ€ä»¤ç‰Œæ–‡ä»¶token>B. ä½¿ç”¨é™æ€ä»¤ç‰Œæ–‡ä»¶(Token)</h3><h4 id=ç”Ÿæˆ-token>ç”Ÿæˆ Token</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ head -c <span class=m>16</span> /dev/urandom <span class=p>|</span> od -An -t x <span class=p>|</span> tr -d <span class=s1>&#39; &#39;</span>
</span></span></code></pre></div><h4 id=åŠ å…¥-kube-config>åŠ å…¥ kube config</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl config set-credentials txl --token<span class=o>=</span>fdb72d94a1c2c2cfbf82341d1f98c68c
</span></span></code></pre></div><h4 id=ä¿®æ”¹-api-server-å¯åŠ¨å‚æ•°>ä¿®æ”¹ api-server å¯åŠ¨å‚æ•°</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo vi /etc/kubernetes/pki/token_auth
</span></span><span class=line><span class=cl><span class=c1># åŠ å…¥</span>
</span></span><span class=line><span class=cl>fdb72d94a1c2c2cfbf82341d1f98c68c,txl,1001
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ sudo vi /etc/kubernetes/manifests/kube-apiserver.yaml
</span></span><span class=line><span class=cl><span class=c1># åŠ å…¥</span>
</span></span><span class=line><span class=cl>--token-auth-file<span class=o>=</span>/etc/kubernetes/pki/token_auth
</span></span></code></pre></div><h4 id=æŸ¥çœ‹>æŸ¥çœ‹</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl -H <span class=s2>&#34;Authorization: Bearer fdb72d94a1c2c2cfbf82341d1f98c68c&#34;</span> https://192.168.0.111:6443/api/v1/namespaces/default/pods --insecure
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;kind&#34;</span>: <span class=s2>&#34;PodList&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;apiVersion&#34;</span>: <span class=s2>&#34;v1&#34;</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;metadata&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;selfLink&#34;</span>: <span class=s2>&#34;/api/v1/namespaces/default/pods&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;resourceVersion&#34;</span>: <span class=s2>&#34;1586027&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>,
</span></span><span class=line><span class=cl>  <span class=s2>&#34;items&#34;</span>: <span class=o>[]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=èµ„æº>èµ„æº</h2><p>æŸ¥çœ‹æ‰€æœ‰èµ„æº</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl api-resources -o wide
</span></span></code></pre></div><p>å…¶ä¸­ VERBS åˆ—å±•ç¤ºäº†è¯¥èµ„æºå¯¹åº”çš„æ“ä½œï¼Œæ¯”å¦‚ role</p><ul><li>create åˆ›å»º</li><li>delete åˆ é™¤</li><li>deletecollection æ‰¹é‡åˆ é™¤</li><li>get è·å–</li><li>list åˆ—è¡¨</li><li>patch åˆå¹¶å˜æ›´</li><li>update æ›´æ–°</li><li>watch ç›‘å¬</li></ul><h2 id=role-å’Œ-rolebinding>Role å’Œ RoleBinding</h2><ul><li>Roleï¼ˆè§’è‰²ï¼‰ï¼šåŒ…å«ä¸€ç»„ä»£è¡¨ç›¸å…³æƒé™çš„è§„åˆ™ï¼Œç”¨äºæˆäºˆå¯¹å•ä¸ªå‘½åç©ºé—´çš„èµ„æºè®¿é—®</li><li>RoleBindingï¼ˆè§’è‰²ç»‘å®šï¼‰ï¼šå°†è§’è‰²ä¸­å®šä¹‰çš„æƒé™èµ‹äºˆä¸€ä¸ªæˆ–è€…ä¸€ç»„ç”¨æˆ·</li></ul><h3 id=åˆ›å»º-role>åˆ›å»º Role</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½äºdefaultçš„roleï¼Œæ‹¥æœ‰å¯¹podçš„è¯»è®¿é—®æƒé™</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ vi role_mypod.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kind: Role
</span></span><span class=line><span class=cl>apiVersion: rbac.authorization.k8s.io/v1
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  namespace: default
</span></span><span class=line><span class=cl>  name: mypod
</span></span><span class=line><span class=cl>rules:
</span></span><span class=line><span class=cl>- apiGroups: <span class=o>[</span><span class=s2>&#34;*&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>  resources: <span class=o>[</span><span class=s2>&#34;pods&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>  verbs: <span class=o>[</span><span class=s2>&#34;get&#34;</span>, <span class=s2>&#34;watch&#34;</span>, <span class=s2>&#34;list&#34;</span><span class=o>]</span>
</span></span></code></pre></div><p>æ‰§è¡Œåˆ›å»º</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl apply -f role_mypod.yaml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹defaultç©ºé—´æ‰€æœ‰role</span>
</span></span><span class=line><span class=cl>$ kubectl get role -n default
</span></span></code></pre></div><p>åˆ é™¤</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl delete role mypod -n default
</span></span></code></pre></div><h3 id=ç»‘å®š-rolebinding>ç»‘å®š RoleBinding</h3><p>åˆ›å»ºä¸€ä¸ªåä¸ºmypodbindingçš„ rolebindingï¼Œå…³è”åˆ›å»ºçš„ç”¨æˆ·txlå’Œåˆ›å»ºçš„è§’è‰²mypod</p><h4 id=1-ä½¿ç”¨å‘½ä»¤>1. ä½¿ç”¨å‘½ä»¤</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl create rolebinding mypodbinding -n default --role mypod --user txl
</span></span></code></pre></div><h4 id=2-ä½¿ç”¨-yaml>2. ä½¿ç”¨ yaml</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>RoleBinding</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mypodrolebinding</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>roleRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Role</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mypod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>subjects</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>User</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>txl</span><span class=w>
</span></span></span></code></pre></div><p>æŸ¥çœ‹</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get rolebinding -n default
</span></span><span class=line><span class=cl>NAME               ROLE
</span></span><span class=line><span class=cl>mypodrolebinding   Role/mypod
</span></span></code></pre></div><p>åˆ é™¤</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl delete rolebinding mypodbinding -n default
</span></span></code></pre></div><h2 id=clusterrole-å’Œ-clusterrolebinding>ClusterRole å’Œ ClusterRoleBinding</h2><p>ClusterRole åŒæ ·å¯ä»¥ç”¨äºæˆäºˆ Role èƒ½å¤Ÿæˆäºˆçš„æƒé™ã€‚ å› ä¸º ClusterRole å±äºé›†ç¾¤èŒƒå›´ï¼Œæ‰€ä»¥å®ƒä¹Ÿå¯ä»¥ä¸ºä»¥ä¸‹èµ„æºæˆäºˆè®¿é—®æƒé™ï¼š</p><ul><li>é›†ç¾¤èŒƒå›´èµ„æºï¼ˆå¦‚èŠ‚ç‚¹ Nodeï¼‰</li><li>éèµ„æºç«¯ç‚¹ï¼ˆå¦‚ <code>/healthz</code>ï¼‰</li><li>è·¨åå­—ç©ºé—´è®¿é—®çš„åå­—ç©ºé—´ä½œç”¨åŸŸçš„èµ„æºï¼ˆå¦‚ Podï¼‰</li></ul><p>clusterRoleä¸é™å®šå‘½åç©ºé—´ï¼Œç»‘å®šæ—¢å¯ä»¥ä½¿ç”¨ RoleBindingï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ ClusterRoleBinding</p><h3 id=åˆ›å»º-clusterrole>åˆ›å»º ClusterRole</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mypod-cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;*&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;pods&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;watch&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><p>æŸ¥çœ‹</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get clusterrole
</span></span></code></pre></div><h3 id=ç»‘å®š-rolebinding-1>ç»‘å®š RoleBinding</h3><p>éœ€è¦æŒ‡å®šå‘½åç©ºé—´</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>RoleBinding</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mypodrolebinding-cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>kube-system</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>roleRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mypod-cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>subjects</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>User</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>shenyi</span><span class=w>
</span></span></span></code></pre></div><p>æŸ¥çœ‹</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get rolebinding -n kube-system
</span></span><span class=line><span class=cl>NAME                                                ROLE
</span></span><span class=line><span class=cl>mypodrolebinding-cluster                            ClusterRole/mypod-cluster
</span></span></code></pre></div><h3 id=ç»‘å®š-clusterrolebinding>ç»‘å®š ClusterRoleBinding</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRoleBinding</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mypod-clusterrolebinding</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>roleRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mypod-cluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>subjects</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span>- <span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>User</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>txl</span><span class=w>
</span></span></span></code></pre></div><h2 id=serviceaccount>ServiceAccount</h2><p>UserAccount æ˜¯å¯ä»¥è·¨ namespace çš„ï¼Œè€Œ ServiceAccount åªèƒ½å±€é™åœ¨è‡ªå·±æ‰€å±çš„ namespace ä¸­ï¼Œæ¯ä¸ª namespace éƒ½ä¼šæœ‰ä¸€ä¸ªé»˜è®¤çš„ default è´¦å· ã€‚</p><h3 id=åˆ›å»º-sa>åˆ›å»º SA</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl create sa mysa
</span></span></code></pre></div><p>ä¹Ÿå¯ä»¥å¯¼å‡ºåˆ° yaml</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create sa mysa -o yaml --dry-run<span class=o>=</span>client &gt; mysa.yaml
</span></span></code></pre></div><p>æŸ¥çœ‹</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get sa -n default
</span></span><span class=line><span class=cl>NAME      SECRETS   AGE
</span></span><span class=line><span class=cl>default   <span class=m>1</span>         4d7h
</span></span><span class=line><span class=cl>mysa      <span class=m>1</span>         5m21s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹ä»¤ç‰Œ</span>
</span></span><span class=line><span class=cl>$ kubectl describe sa mysa
</span></span><span class=line><span class=cl>Name:                mysa
</span></span><span class=line><span class=cl>Namespace:           default
</span></span><span class=line><span class=cl>Labels:              &lt;none&gt;
</span></span><span class=line><span class=cl>Annotations:         &lt;none&gt;
</span></span><span class=line><span class=cl>Image pull secrets:  &lt;none&gt;
</span></span><span class=line><span class=cl>Mountable secrets:   mysa-token-5bnbm
</span></span><span class=line><span class=cl>Tokens:              mysa-token-5bnbm
</span></span><span class=line><span class=cl>Events:              &lt;none&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ kubectl describe secret mysa-token-5bnbm
</span></span></code></pre></div><h3 id=ç»‘å®š-clusterrolebinding-1>ç»‘å®š ClusterRoleBinding</h3><p>ä½¿ç”¨å‘½ä»¤çš„æ–¹å¼</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl create clusterrolebinding mysa-clusterrolebinding --clusterrole<span class=o>=</span>mypod-cluster --serviceaccount<span class=o>=</span>default:mysa
</span></span></code></pre></div><p>æŸ¥çœ‹</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get clusterrolebinding
</span></span><span class=line><span class=cl>NAME                                                   ROLE
</span></span><span class=line><span class=cl>mypod-clusterrolebinding                               ClusterRole/mypod-cluster
</span></span><span class=line><span class=cl>mysa-clusterrolebinding                                ClusterRole/mypod-cluster
</span></span></code></pre></div><h3 id=å¤–éƒ¨è®¿é—®-api>å¤–éƒ¨è®¿é—® API</h3><h4 id=å®‰è£…-jq>å®‰è£… jq</h4><p>è½»é‡çº§çš„ json å¤„ç†å‘½ä»¤ã€‚å¯ä»¥å¯¹ json æ•°æ®è¿›è¡Œåˆ†ç‰‡ã€è¿‡æ»¤ã€æ˜ å°„ã€è½¬æ¢å’Œæ ¼å¼åŒ–è¾“å‡º</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ sudo yum install jq -y
</span></span></code></pre></div><h4 id=è·å–-sa-token>è·å– SA Token</h4><p>ä¿å­˜åˆ°ä¸´æ—¶å˜é‡ mysatoken ä¸­</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nv>mysatoken</span><span class=o>=</span><span class=k>$(</span>kubectl get secret  <span class=k>$(</span>kubectl get sa  mysa -o json <span class=p>|</span> jq -Mr <span class=s1>&#39;.secrets[0].name&#39;</span><span class=k>)</span> -o json <span class=p>|</span> jq -Mr <span class=s1>&#39;.data.token&#39;</span> <span class=p>|</span> base64 -d<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># æŸ¥çœ‹token</span>
</span></span><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=nv>$mysatoken</span>
</span></span></code></pre></div><p>è¯·æ±‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl -H <span class=s2>&#34;Authorization: Bearer </span><span class=nv>$mysatoken</span><span class=s2>&#34;</span> --insecure https://192.168.0.111:6443/api/v1/namespaces/default/pods 
</span></span></code></pre></div><h3 id=åœ¨-pod-é‡Œè®¿é—®-api>åœ¨ Pod é‡Œè®¿é—® API</h3><p>åˆ›å»ºä¸€ä¸ªæµ‹è¯• pod</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>serviceAccountName</span><span class=p>:</span><span class=w> </span><span class=l>mysa </span><span class=w> </span><span class=c># æŒ‡å®šSAï¼Œå¦åˆ™ä½¿ç”¨çš„default SA </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginxtest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.18-alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>IfNotPresent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></div><p>æŸ¥çœ‹ pod</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get pod
</span></span><span class=line><span class=cl>NAME                     READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>myngx-74748c5956-5rfrs   1/1     Running   <span class=m>0</span>          4m21s
</span></span></code></pre></div><p>è¿›å…¥å®¹å™¨</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl <span class=nb>exec</span> -it myngx-74748c5956-5rfrs -- sh
</span></span></code></pre></div><p>è®¾ç½®ä¸´æ—¶å˜é‡</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># SA token</span>
</span></span><span class=line><span class=cl>$ <span class=nv>TOKEN</span><span class=o>=</span><span class=sb>`</span>cat /var/run/secrets/kubernetes.io/serviceaccount/token<span class=sb>`</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># api serveråœ°å€</span>
</span></span><span class=line><span class=cl>$ <span class=nv>APISERVER</span><span class=o>=</span><span class=s2>&#34;https://</span><span class=nv>$KUBERNETES_SERVICE_HOST</span><span class=s2>:</span><span class=nv>$KUBERNETES_PORT_443_TCP_PORT</span><span class=s2>&#34;</span>
</span></span></code></pre></div><p>è¯·æ±‚ï¼ˆè·³è¿‡æœåŠ¡å™¨è¯ä¹¦æ£€æŸ¥ï¼‰</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl --header <span class=s2>&#34;Authorization: Bearer </span><span class=nv>$TOKEN</span><span class=s2>&#34;</span> --insecure -s <span class=nv>$APISERVER</span>/api/v1/namespaces/default/pods 
</span></span></code></pre></div><p>ä½¿ç”¨è¯ä¹¦è¯·æ±‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl --header <span class=s2>&#34;Authorization: Bearer </span><span class=nv>$TOKEN</span><span class=s2>&#34;</span> --cacert /var/run/secrets/kubernetes.io/serviceaccount/ca.crt <span class=nv>$APISERVER</span>/api/v1/namespaces/default/pods 
</span></span></code></pre></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-12-14&nbsp;<a class=git-hash href=https://github.com/xuliangTang/xuliangTang.github.io/commit/2856aa864f09517d7a48e82c5e7aec21a5b7427d target=_blank title="commit by xuliangTang(1297441127@qq.com) 2856aa864f09517d7a48e82c5e7aec21a5b7427d: ğŸ‰ Initial Commit">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>2856aa8</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=http://xuliangtang.github.io/posts/rbac/ data-title="K8s è®¤è¯å’Œæˆæƒ"><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=http://xuliangtang.github.io/posts/rbac/><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=http://xuliangtang.github.io/posts/rbac/ data-title="K8s è®¤è¯å’Œæˆæƒ"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=http://xuliangtang.github.io/posts/rbac/ data-title="K8s è®¤è¯å’Œæˆæƒ"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on å¾®åš" data-sharer=weibo data-url=http://xuliangtang.github.io/posts/rbac/ data-title="K8s è®¤è¯å’Œæˆæƒ"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/kubeadm/ class=prev rel=prev title="ä½¿ç”¨ kubeadm éƒ¨ç½² k8s"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>ä½¿ç”¨ kubeadm éƒ¨ç½² k8s</a>
<a href=/posts/pod/ class=next rel=next title=Pod>Pod<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.108.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>xuliangTang</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:100},comment:{},search:{algoliaAppID:"4ZKRIKL2L6",algoliaIndex:"dev_lain",algoliaSearchKey:"2da9b5e339083fde5fe030c2345f5499",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:80,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>