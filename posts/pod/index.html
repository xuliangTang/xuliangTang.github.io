<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Pod - Lain Blog</title><meta name=Description content="This is my cool site"><meta property="og:title" content="Pod"><meta property="og:description" content="æ–‡æ¡£ï¼šPod | Kubernetes Pod æ˜¯å¯ä»¥åœ¨ Kubernetes ä¸­åˆ›å»ºå’Œç®¡ç†çš„ã€æœ€å°çš„å¯éƒ¨ç½²çš„è®¡ç®—å•å…ƒã€‚å®ƒæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„ç»„åˆã€‚è¿™äº›å®¹å™¨å…±äº«å­˜å‚¨ã€ç½‘ç»œå’Œå‘½åç©ºé—´ï¼Œä»¥åŠå¦‚ä½•è¿è¡Œ"><meta property="og:type" content="article"><meta property="og:url" content="http://xuliangtang.github.io/posts/pod/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-04T00:00:00+00:00"><meta property="article:modified_time" content="2022-12-14T22:37:46+08:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary"><meta name=twitter:title content="Pod"><meta name=twitter:description content="æ–‡æ¡£ï¼šPod | Kubernetes Pod æ˜¯å¯ä»¥åœ¨ Kubernetes ä¸­åˆ›å»ºå’Œç®¡ç†çš„ã€æœ€å°çš„å¯éƒ¨ç½²çš„è®¡ç®—å•å…ƒã€‚å®ƒæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„ç»„åˆã€‚è¿™äº›å®¹å™¨å…±äº«å­˜å‚¨ã€ç½‘ç»œå’Œå‘½åç©ºé—´ï¼Œä»¥åŠå¦‚ä½•è¿è¡Œ"><meta name=application-name content="Lain Blog"><meta name=apple-mobile-web-app-title content="Lain Blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicons/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://xuliangtang.github.io/posts/pod/><link rel=prev href=http://xuliangtang.github.io/posts/rbac/><link rel=next href=http://xuliangtang.github.io/posts/configmap/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Pod","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/xuliangtang.github.io\/posts\/pod\/"},"genre":"posts","wordcount":1302,"url":"http:\/\/xuliangtang.github.io\/posts\/pod\/","datePublished":"2022-12-04T00:00:00+00:00","dateModified":"2022-12-14T22:37:46+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"xuliangTang"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Lain Blog">Dev Lain</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>æ–‡ç«  </a><a class=menu-item href=/tags/>æ ‡ç­¾ </a><a class=menu-item href=/categories/>åˆ†ç±» </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Lain Blog">Dev Lain</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>æ–‡ç« </a><a class=menu-item href=/tags/ title>æ ‡ç­¾</a><a class=menu-item href=/categories/ title>åˆ†ç±»</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Pod</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>xuliangTang</a></span>&nbsp;<span class=post-category>included in <a href=/categories/kubernetes/><i class="far fa-folder fa-fw" aria-hidden=true></i>kubernetes</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-12-04>2022-12-04</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1302 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;3 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#pod-åŸºæœ¬ä½¿ç”¨>Pod åŸºæœ¬ä½¿ç”¨</a><ul><li><a href=#åˆ›å»º>åˆ›å»º</a></li></ul></li><li><a href=#ä½¿ç”¨-deployment>ä½¿ç”¨ Deployment</a><ul><li><a href=#æŒ‚è½½>æŒ‚è½½</a></li><li><a href=#å…±äº«æ–‡ä»¶å¤¹>å…±äº«æ–‡ä»¶å¤¹</a></li><li><a href=#init-å®¹å™¨>Init å®¹å™¨</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>æ–‡æ¡£ï¼š<a href=https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/ target=_blank rel="noopener noreffer">Pod | Kubernetes</a></p><p>Pod æ˜¯å¯ä»¥åœ¨ Kubernetes ä¸­åˆ›å»ºå’Œç®¡ç†çš„ã€æœ€å°çš„å¯éƒ¨ç½²çš„è®¡ç®—å•å…ƒã€‚å®ƒæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„ç»„åˆã€‚è¿™äº›å®¹å™¨å…±äº«å­˜å‚¨ã€ç½‘ç»œå’Œå‘½åç©ºé—´ï¼Œä»¥åŠå¦‚ä½•è¿è¡Œçš„è§„èŒƒã€‚å…¶å®ƒçš„èµ„æºå¯¹è±¡éƒ½æ˜¯ç”¨æ¥æ”¯æ’‘æˆ–è€…æ‰©å±• Pod å¯¹è±¡åŠŸèƒ½çš„ï¼Œæ¯”å¦‚æ§åˆ¶å™¨å¯¹è±¡æ˜¯ç”¨æ¥ç®¡æ§ Pod å¯¹è±¡çš„ï¼ŒService æˆ–è€… Ingress èµ„æºå¯¹è±¡æ˜¯ç”¨æ¥æš´éœ² Pod å¼•ç”¨å¯¹è±¡çš„ï¼ŒPersistentVolume èµ„æºå¯¹è±¡æ˜¯ç”¨æ¥ä¸º Pod æä¾›å­˜å‚¨ç­‰ç­‰ï¼ŒK8S ä¸ä¼šç›´æ¥å¤„ç†å®¹å™¨ï¼Œè€Œæ˜¯ Podï¼ŒPod æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ª container ç»„æˆã€‚åŸºæœ¬çš„å¥½å¤„æœ‰ï¼š</p><ol><li><p>æ–¹ä¾¿éƒ¨ç½²ã€æ‰©å±•å’Œæ”¶ç¼©ã€æ–¹ä¾¿è°ƒåº¦ç­‰</p></li><li><p>Podä¸­çš„å®¹å™¨å…±äº«æ•°æ®å’Œç½‘ç»œç©ºé—´ï¼Œç»Ÿä¸€çš„èµ„æºç®¡ç†ä¸åˆ†é…</p></li></ol><p>åœ¨Podä¸­ï¼Œæ‰€æœ‰å®¹å™¨éƒ½è¢«åŒä¸€å®‰æ’å’Œè°ƒåº¦ï¼Œå¹¶è¿è¡Œåœ¨å…±äº«çš„ä¸Šä¸‹æ–‡ä¸­ã€‚å¯¹äºå…·ä½“åº”ç”¨è€Œè¨€ï¼ŒPodæ˜¯å®ƒä»¬çš„é€»è¾‘ä¸»æœºï¼ŒPodåŒ…å«ä¸šåŠ¡ç›¸å…³çš„å¤šä¸ªåº”ç”¨å®¹å™¨ã€‚</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/image-20221206200429843.png data-srcset="https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/image-20221206200429843.png, https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/image-20221206200429843.png 1.5x, https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/image-20221206200429843.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/image-20221206200429843.png title=image-20221206200429843></p><p>æ¯ä¸€ä¸ª Pod éƒ½æœ‰ä¸€ä¸ªç‰¹æ®Šçš„è¢«ç§°ä¸º â€œæ ¹å®¹å™¨â€ çš„ Pause å®¹å™¨ã€‚Pause å®¹å™¨å¯¹åº”çš„é•œåƒå±äº Kubernetes å¹³å°çš„ä¸€éƒ¨åˆ†ï¼Œé™¤äº† Pause å®¹å™¨ï¼Œæ¯ä¸ª Pod è¿˜åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªç´§å¯†ç›¸å…³çš„ç”¨æˆ·ä¸šåŠ¡å®¹å™¨ã€‚Pause å®¹å™¨çš„ä½œç”¨ï¼š</p><ul><li>æ‰®æ¼” Pid=1 çš„ï¼Œå›æ”¶åƒµå°¸è¿›ç¨‹</li><li>åŸºäº Linux çš„ namespace çš„å…±äº«</li></ul><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/370d5cae852e417cb610697eb4eb4a31.jpeg data-srcset="https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/370d5cae852e417cb610697eb4eb4a31.jpeg, https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/370d5cae852e417cb610697eb4eb4a31.jpeg 1.5x, https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/370d5cae852e417cb610697eb4eb4a31.jpeg 2x" data-sizes=auto alt=https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/370d5cae852e417cb610697eb4eb4a31.jpeg title=img></p><h2 id=pod-åŸºæœ¬ä½¿ç”¨>Pod åŸºæœ¬ä½¿ç”¨</h2><p>Pod é€šå¸¸ä¸æ˜¯ç›´æ¥åˆ›å»ºçš„ï¼Œè€Œæ˜¯ä½¿ç”¨å·¥ä½œè´Ÿè½½èµ„æºåˆ›å»ºçš„</p><h3 id=åˆ›å»º>åˆ›å»º</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;nginx:1.18-alpine&#34;</span><span class=w>
</span></span></span></code></pre></div><p>å±•ç¤ºè¯¦ç»†ä¿¡æ¯</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get pod -o wide
</span></span><span class=line><span class=cl>NAME    READY   STATUS    RESTARTS   AGE   IP           NODE    NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=cl>myngx   1/1     Running   <span class=m>0</span>          13m   10.244.3.7   lain2   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><h2 id=ä½¿ç”¨-deployment>ä½¿ç”¨ Deployment</h2><p>deployment è¿è¡Œä¸€ç»„ç›¸åŒçš„ Podï¼ˆå‰¯æœ¬æ°´å¹³æ‰©å±•ï¼‰ã€æ»šåŠ¨æ›´æ–°ã€‚é€šè¿‡å‰¯æœ¬é›†ç®¡ç†å’Œåˆ›å»ºPOD</p><h3 id=æŒ‚è½½>æŒ‚è½½</h3><p>æŒ‚è½½ <code>hostPath</code> ä¸»æœºç›®å½•å·å®ä¾‹</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;nginx:1.18-alpine&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>  </span><span class=c># å£°æ˜å®¹å™¨ä¸­çš„æŒ‚è½½ä½ç½®</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mydata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>alpine </span><span class=w> </span><span class=c># æµ‹è¯•å¤šå®¹å™¨</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;sh&#34;</span><span class=p>,</span><span class=s2>&#34;-c&#34;</span><span class=p>,</span><span class=s2>&#34;echo this is alpine &amp;&amp; sleep 3600&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;alpine:3.12&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mydata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>hostPath</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/home/txl/yaml/data	</span><span class=w> </span><span class=c># å£°æ˜ä¸»æœºèŠ‚ç‚¹ç›®å½• </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Directory </span><span class=w> </span><span class=c># æŒ‡å®štype</span><span class=w>
</span></span></span></code></pre></div><p>hostPath æ”¯æŒçš„ type å€¼å¦‚ä¸‹ï¼š</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/image-20221204171417323.png data-srcset="https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/image-20221204171417323.png, https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/image-20221204171417323.png 1.5x, https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/image-20221204171417323.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/xuliangTang/picbeds/main/typora/image-20221204171417323.png title=image-20221204171417323></p><h3 id=å…±äº«æ–‡ä»¶å¤¹>å…±äº«æ–‡ä»¶å¤¹</h3><p>åŒä¸€ä¸ª pod å†…çš„å®¹å™¨éƒ½èƒ½è¯»å†™ <code>EmptyDir</code> ä¸­çš„æ–‡ä»¶ã€‚å¸¸ç”¨äºä¸´æ—¶ç©ºé—´ã€å¤šå®¹å™¨å…±äº«ï¼Œå¦‚æ—¥å¿—æˆ–è€…tmpæ–‡ä»¶éœ€è¦çš„ä¸´æ—¶ç›®å½•</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.18-alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>IfNotPresent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sharedata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>alpine:3.12</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>IfNotPresent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;sh&#34;</span><span class=p>,</span><span class=s2>&#34;-c&#34;</span><span class=p>,</span><span class=s2>&#34;echo this is alpine &amp;&amp; sleep 36000&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sharedata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w>  </span><span class=l>sharedata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span></code></pre></div><h3 id=init-å®¹å™¨>Init å®¹å™¨</h3><p>æ–‡æ¡£ï¼š<a href=https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/init-containers/ target=_blank rel="noopener noreffer">Init å®¹å™¨ | Kubernetes</a></p><p>Init å®¹å™¨æ˜¯ä¸€ç§ç‰¹æ®Šå®¹å™¨ï¼Œåœ¨ <a href=https://kubernetes.io/zh-cn/docs/concepts/workloads/pods/ target=_blank rel="noopener noreffer">Pod</a> å†…çš„åº”ç”¨å®¹å™¨å¯åŠ¨ä¹‹å‰è¿è¡Œã€‚Init å®¹å™¨å¯ä»¥åŒ…æ‹¬ä¸€äº›åº”ç”¨é•œåƒä¸­ä¸å­˜åœ¨çš„å®ç”¨å·¥å…·å’Œå®‰è£…è„šæœ¬ã€‚</p><p>Init å®¹å™¨ä¸æ™®é€šçš„å®¹å™¨éå¸¸åƒï¼Œé™¤äº†å¦‚ä¸‹ä¸¤ç‚¹ï¼š</p><ul><li>å®ƒä»¬æ€»æ˜¯è¿è¡Œåˆ°å®Œæˆã€‚</li><li>æ¯ä¸ªéƒ½å¿…é¡»åœ¨ä¸‹ä¸€ä¸ªå¯åŠ¨ä¹‹å‰æˆåŠŸå®Œæˆã€‚</li></ul><p>å¦‚æœ Pod çš„ Init å®¹å™¨å¤±è´¥ï¼Œkubelet ä¼šä¸æ–­åœ°é‡å¯è¯¥ Init å®¹å™¨ç›´åˆ°è¯¥å®¹å™¨æˆåŠŸä¸ºæ­¢ã€‚ ç„¶è€Œï¼Œå¦‚æœ Pod å¯¹åº”çš„ restartPolicy å€¼ä¸º &ldquo;Never&rdquo;ï¼ŒKubernetes ä¸ä¼šé‡æ–°å¯åŠ¨ Podã€‚</p><h4 id=åŸç†>åŸç†</h4><p>åœ¨ Pod å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ª Init å®¹å™¨ä¼šåœ¨ç½‘ç»œå’Œæ•°æ®å·åˆå§‹åŒ–ä¹‹åæŒ‰é¡ºåºå¯åŠ¨ã€‚ ä¾æ® Init å®¹å™¨åœ¨ Pod spec é…ç½®ä¸­çš„å‡ºç°é¡ºåºä¾æ¬¡è¿è¡Œã€‚ç”±äº Pod å¯èƒ½å„ç§åŸå› å¤šæ¬¡é‡å¯ï¼Œæ‰€ä»¥ Init å®¹å™¨ä¸­çš„æ“ä½œï¼Œé¡»å…·å¤‡å¹‚ç­‰æ€§ã€‚</p><h4 id=åº”ç”¨åœºæ™¯>åº”ç”¨åœºæ™¯</h4><ul><li>ç¯å¢ƒæ£€æŸ¥ï¼šä¾‹å¦‚ç¡®ä¿åº”ç”¨å®¹å™¨ä¾èµ–çš„æœåŠ¡å¯åŠ¨åå†å¯åŠ¨åº”ç”¨å®¹å™¨</li><li>åˆå§‹åŒ–é…ç½®ï¼šä¾‹å¦‚ç»™åº”ç”¨å®¹å™¨å‡†å¤‡é…ç½®æ–‡ä»¶</li></ul><h4 id=åŸºæœ¬é…ç½®>åŸºæœ¬é…ç½®</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>initContainers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>init-mydb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>alpine:3.12</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s1>&#39;sh&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;-c&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;echo wait for db &amp;&amp; sleep 35 &amp;&amp; echo done&#39;</span><span class=p>]</span><span class=w> </span><span class=c># æ¨¡æ‹Ÿç­‰å¾…35s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ngx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.18-alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>IfNotPresent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sharedata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>alpine:3.12</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>IfNotPresent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;sh&#34;</span><span class=p>,</span><span class=s2>&#34;-c&#34;</span><span class=p>,</span><span class=s2>&#34;echo this is alpine &amp;&amp; sleep 36000&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sharedata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>              </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w>  </span><span class=l>sharedata</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></span></span></code></pre></div><p>æŸ¥çœ‹ init å®¹å™¨çŠ¶æ€</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get pod
</span></span><span class=line><span class=cl>NAME                    READY   STATUS     RESTARTS   AGE
</span></span><span class=line><span class=cl>myngx-89dd8586b-k59pl   0/2     Init:0/1   <span class=m>0</span>          8s
</span></span></code></pre></div><table><thead><tr><th>çŠ¶æ€</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>Init:N/M</code></td><td>Pod åŒ…å« <code>M</code> ä¸ª Init å®¹å™¨ï¼Œå…¶ä¸­ <code>N</code> ä¸ªå·²ç»è¿è¡Œå®Œæˆã€‚</td></tr><tr><td><code>Init:Error</code></td><td>Init å®¹å™¨å·²æ‰§è¡Œå¤±è´¥ã€‚</td></tr><tr><td><code>Init:CrashLoopBackOff</code></td><td>Init å®¹å™¨æ‰§è¡Œæ€»æ˜¯å¤±è´¥ã€‚</td></tr><tr><td><code>Pending</code></td><td>Pod è¿˜æ²¡æœ‰å¼€å§‹æ‰§è¡Œ Init å®¹å™¨ã€‚</td></tr><tr><td><code>PodInitializing</code> or <code>Running</code></td><td>Pod å·²ç»å®Œæˆæ‰§è¡Œ Init å®¹å™¨ã€‚</td></tr></tbody></table></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-12-14&nbsp;<a class=git-hash href=https://github.com/xuliangTang/xuliangTang.github.io/commit/2856aa864f09517d7a48e82c5e7aec21a5b7427d target=_blank title="commit by xuliangTang(1297441127@qq.com) 2856aa864f09517d7a48e82c5e7aec21a5b7427d: ğŸ‰ Initial Commit">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>2856aa8</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=http://xuliangtang.github.io/posts/pod/ data-title=Pod><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=http://xuliangtang.github.io/posts/pod/><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=http://xuliangtang.github.io/posts/pod/ data-title=Pod><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=http://xuliangtang.github.io/posts/pod/ data-title=Pod><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on å¾®åš" data-sharer=weibo data-url=http://xuliangtang.github.io/posts/pod/ data-title=Pod><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/rbac/ class=prev rel=prev title="K8s è®¤è¯å’Œæˆæƒ"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>K8s è®¤è¯å’Œæˆæƒ</a>
<a href=/posts/configmap/ class=next rel=next title=ConfigMap>ConfigMap<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.108.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>xuliangTang</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:100},comment:{},search:{algoliaAppID:"4ZKRIKL2L6",algoliaIndex:"dev_lain",algoliaSearchKey:"2da9b5e339083fde5fe030c2345f5499",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:80,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>